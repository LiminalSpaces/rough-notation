"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const t="http://www.w3.org/2000/svg";function e(t,e,s){if(t&&t.length){const[n,o]=e,h=Math.PI/180*s,a=Math.cos(h),i=Math.sin(h);for(const e of t){const[t,s]=e;e[0]=(t-n)*a-(s-o)*i+n,e[1]=(t-n)*i+(s-o)*a+o}}}function s(t,s,n,o=1){const h=n,a=Math.max(s,.1),i=t[0]&&t[0][0]&&"number"==typeof t[0][0]?[t]:t,r=[0,0];if(h)for(const t of i)e(t,r,h);const c=function(t,e,s){const n=[];for(const e of t){const t=[...e];o=t[0],h=t[t.length-1],(o[0]!==h[0]||o[1]!==h[1])&&t.push([t[0][0],t[0][1]]),t.length>2&&n.push(t)}var o,h;const a=[];e=Math.max(e,.1);const i=[];for(const t of n)for(let e=0;e<t.length-1;e++){const s=t[e],n=t[e+1];if(s[1]!==n[1]){const t=Math.min(s[1],n[1]);i.push({ymin:t,ymax:Math.max(s[1],n[1]),x:t===s[1]?s[0]:n[0],islope:(n[0]-s[0])/(n[1]-s[1])})}}if(i.sort((t,e)=>t.ymin<e.ymin?-1:t.ymin>e.ymin?1:t.x<e.x?-1:t.x>e.x?1:t.ymax===e.ymax?0:(t.ymax-e.ymax)/Math.abs(t.ymax-e.ymax)),!i.length)return a;let r=[],c=i[0].ymin,l=0;for(;r.length||i.length;){if(i.length){let t=-1;for(let e=0;e<i.length&&!(i[e].ymin>c);e++)t=e;i.splice(0,t+1).forEach(t=>{r.push({s:c,edge:t})})}if(r=r.filter(t=>!(t.edge.ymax<=c)),r.sort((t,e)=>t.edge.x===e.edge.x?0:(t.edge.x-e.edge.x)/Math.abs(t.edge.x-e.edge.x)),(1!==s||l%e==0)&&r.length>1)for(let t=0;t<r.length;t+=2){const e=t+1;if(e>=r.length)break;const s=r[t].edge,n=r[e].edge;a.push([[Math.round(s.x),c],[Math.round(n.x),c]])}c+=s,r.forEach(t=>{t.edge.x=t.edge.x+s*t.edge.islope}),l++}return a}(i,a,o);if(h){for(const t of i)e(t,r,-h);!function(t,s,n){const o=[];t.forEach(t=>o.push(...t)),e(o,s,n)}(c,r,-h)}return c}function n(t,e){var n;const o=e.hachureAngle+90;let h=e.hachureGap;h<0&&(h=4*e.strokeWidth),h=Math.round(Math.max(h,.1));let a=1;return e.roughness>=1&&((null===(n=e.randomizer)||void 0===n?void 0:n.next())||Math.random())>.7&&(a=h),s(t,h,o,a||1)}class o{constructor(t){this.helper=t}fillPolygons(t,e){return this._fillPolygons(t,e)}_fillPolygons(t,e){const s=n(t,e);return{type:"fillSketch",ops:this.renderLines(s,e)}}renderLines(t,e){const s=[];for(const n of t)s.push(...this.helper.doubleLineOps(n[0][0],n[0][1],n[1][0],n[1][1],e));return s}}function h(t){const e=t[0],s=t[1];return Math.sqrt(Math.pow(e[0]-s[0],2)+Math.pow(e[1]-s[1],2))}class a extends o{fillPolygons(t,e){let s=e.hachureGap;s<0&&(s=4*e.strokeWidth),s=Math.max(s,.1);const o=n(t,Object.assign({},e,{hachureGap:s})),a=Math.PI/180*e.hachureAngle,i=[],r=.5*s*Math.cos(a),c=.5*s*Math.sin(a);for(const[t,e]of o)h([t,e])&&i.push([[t[0]-r,t[1]+c],[...e]],[[t[0]+r,t[1]-c],[...e]]);return{type:"fillSketch",ops:this.renderLines(i,e)}}}class i extends o{fillPolygons(t,e){const s=this._fillPolygons(t,e),n=Object.assign({},e,{hachureAngle:e.hachureAngle+90}),o=this._fillPolygons(t,n);return s.ops=s.ops.concat(o.ops),s}}class r{constructor(t){this.helper=t}fillPolygons(t,e){const s=n(t,e=Object.assign({},e,{hachureAngle:0}));return this.dotsOnLines(s,e)}dotsOnLines(t,e){const s=[];let n=e.hachureGap;n<0&&(n=4*e.strokeWidth),n=Math.max(n,.1);let o=e.fillWeight;o<0&&(o=e.strokeWidth/2);const a=n/4;for(const i of t){const t=h(i),r=t/n,c=Math.ceil(r)-1,l=t-c*n,u=(i[0][0]+i[1][0])/2-n/4,f=Math.min(i[0][1],i[1][1]);for(let t=0;t<c;t++){const h=f+l+t*n,i=u-a+2*Math.random()*a,r=h-a+2*Math.random()*a,c=this.helper.ellipse(i,r,o,o,e);s.push(...c.ops)}}return{type:"fillSketch",ops:s}}}class c{constructor(t){this.helper=t}fillPolygons(t,e){const s=n(t,e);return{type:"fillSketch",ops:this.dashedLine(s,e)}}dashedLine(t,e){const s=e.dashOffset<0?e.hachureGap<0?4*e.strokeWidth:e.hachureGap:e.dashOffset,n=e.dashGap<0?e.hachureGap<0?4*e.strokeWidth:e.hachureGap:e.dashGap,o=[];return t.forEach(t=>{const a=h(t),i=Math.floor(a/(s+n)),r=(a+n-i*(s+n))/2;let c=t[0],l=t[1];c[0]>l[0]&&(c=t[1],l=t[0]);const u=Math.atan((l[1]-c[1])/(l[0]-c[0]));for(let t=0;t<i;t++){const h=t*(s+n),a=h+s,i=[c[0]+h*Math.cos(u)+r*Math.cos(u),c[1]+h*Math.sin(u)+r*Math.sin(u)],l=[c[0]+a*Math.cos(u)+r*Math.cos(u),c[1]+a*Math.sin(u)+r*Math.sin(u)];o.push(...this.helper.doubleLineOps(i[0],i[1],l[0],l[1],e))}}),o}}class l{constructor(t){this.helper=t}fillPolygons(t,e){const s=e.hachureGap<0?4*e.strokeWidth:e.hachureGap,o=e.zigzagOffset<0?s:e.zigzagOffset,h=n(t,e=Object.assign({},e,{hachureGap:s+o}));return{type:"fillSketch",ops:this.zigzagLines(h,o,e)}}zigzagLines(t,e,s){const n=[];return t.forEach(t=>{const o=h(t),a=Math.round(o/(2*e));let i=t[0],r=t[1];i[0]>r[0]&&(i=t[1],r=t[0]);const c=Math.atan((r[1]-i[1])/(r[0]-i[0]));for(let t=0;t<a;t++){const o=2*t*e,h=2*(t+1)*e,a=Math.sqrt(2*Math.pow(e,2)),r=[i[0]+o*Math.cos(c),i[1]+o*Math.sin(c)],l=[i[0]+h*Math.cos(c),i[1]+h*Math.sin(c)],u=[r[0]+a*Math.cos(c+Math.PI/4),r[1]+a*Math.sin(c+Math.PI/4)];n.push(...this.helper.doubleLineOps(r[0],r[1],u[0],u[1],s),...this.helper.doubleLineOps(u[0],u[1],l[0],l[1],s))}}),n}}const u={};function f(){return Math.floor(Math.random()*2**31)}class p{constructor(t){this.seed=t}next(){return this.seed?(2**31-1&(this.seed=Math.imul(48271,this.seed)))/2**31:Math.random()}}const g={A:7,a:7,C:6,c:6,H:1,h:1,L:2,l:2,M:2,m:2,Q:4,q:4,S:4,s:4,T:2,t:2,V:1,v:1,Z:0,z:0};function d(t,e){return t.type===e}function M(t){const e=[],s=function(t){const e=new Array;for(;""!==t;)if(t.match(/^([ \t\r\n,]+)/))t=t.substr(RegExp.$1.length);else if(t.match(/^([aAcChHlLmMqQsStTvVzZ])/))e[e.length]={type:0,text:RegExp.$1},t=t.substr(RegExp.$1.length);else{if(!t.match(/^(([-+]?[0-9]+(\.[0-9]*)?|[-+]?\.[0-9]+)([eE][-+]?[0-9]+)?)/))return[];e[e.length]={type:1,text:""+parseFloat(RegExp.$1)},t=t.substr(RegExp.$1.length)}return e[e.length]={type:2,text:""},e}(t);let n="BOD",o=0,h=s[o];for(;!d(h,2);){let a=0;const i=[];if("BOD"===n){if("M"!==h.text&&"m"!==h.text)return M("M0,0"+t);o++,a=g[h.text],n=h.text}else d(h,1)?a=g[n]:(o++,a=g[h.text],n=h.text);if(!(o+a<s.length))throw new Error("Path data ended short");for(let t=o;t<o+a;t++){const e=s[t];if(!d(e,1))throw new Error("Param not a number: "+n+","+e.text);i[i.length]=+e.text}if("number"!=typeof g[n])throw new Error("Bad segment: "+n);{const t={key:n,data:i};e.push(t),o+=a,h=s[o],"M"===n&&(n="L"),"m"===n&&(n="l")}}return e}function k(t){let e=0,s=0,n=0,o=0;const h=[];for(const{key:a,data:i}of t)switch(a){case"M":h.push({key:"M",data:[...i]}),[e,s]=i,[n,o]=i;break;case"m":e+=i[0],s+=i[1],h.push({key:"M",data:[e,s]}),n=e,o=s;break;case"L":h.push({key:"L",data:[...i]}),[e,s]=i;break;case"l":e+=i[0],s+=i[1],h.push({key:"L",data:[e,s]});break;case"C":h.push({key:"C",data:[...i]}),e=i[4],s=i[5];break;case"c":{const t=i.map((t,n)=>n%2?t+s:t+e);h.push({key:"C",data:t}),e=t[4],s=t[5];break}case"Q":h.push({key:"Q",data:[...i]}),e=i[2],s=i[3];break;case"q":{const t=i.map((t,n)=>n%2?t+s:t+e);h.push({key:"Q",data:t}),e=t[2],s=t[3];break}case"A":h.push({key:"A",data:[...i]}),e=i[5],s=i[6];break;case"a":e+=i[5],s+=i[6],h.push({key:"A",data:[i[0],i[1],i[2],i[3],i[4],e,s]});break;case"H":h.push({key:"H",data:[...i]}),e=i[0];break;case"h":e+=i[0],h.push({key:"H",data:[e]});break;case"V":h.push({key:"V",data:[...i]}),s=i[0];break;case"v":s+=i[0],h.push({key:"V",data:[s]});break;case"S":h.push({key:"S",data:[...i]}),e=i[2],s=i[3];break;case"s":{const t=i.map((t,n)=>n%2?t+s:t+e);h.push({key:"S",data:t}),e=t[2],s=t[3];break}case"T":h.push({key:"T",data:[...i]}),e=i[0],s=i[1];break;case"t":e+=i[0],s+=i[1],h.push({key:"T",data:[e,s]});break;case"Z":case"z":h.push({key:"Z",data:[]}),e=n,s=o}return h}function m(t){const e=[];let s="",n=0,o=0,h=0,a=0,i=0,r=0;for(const{key:c,data:l}of t){switch(c){case"M":e.push({key:"M",data:[...l]}),[n,o]=l,[h,a]=l;break;case"C":e.push({key:"C",data:[...l]}),n=l[4],o=l[5],i=l[2],r=l[3];break;case"L":e.push({key:"L",data:[...l]}),[n,o]=l;break;case"H":n=l[0],e.push({key:"L",data:[n,o]});break;case"V":o=l[0],e.push({key:"L",data:[n,o]});break;case"S":{let t=0,h=0;"C"===s||"S"===s?(t=n+(n-i),h=o+(o-r)):(t=n,h=o),e.push({key:"C",data:[t,h,...l]}),i=l[0],r=l[1],n=l[2],o=l[3];break}case"T":{const[t,h]=l;let a=0,c=0;"Q"===s||"T"===s?(a=n+(n-i),c=o+(o-r)):(a=n,c=o);const u=n+2*(a-n)/3,f=o+2*(c-o)/3,p=t+2*(a-t)/3,g=h+2*(c-h)/3;e.push({key:"C",data:[u,f,p,g,t,h]}),i=a,r=c,n=t,o=h;break}case"Q":{const[t,s,h,a]=l,c=n+2*(t-n)/3,u=o+2*(s-o)/3,f=h+2*(t-h)/3,p=a+2*(s-a)/3;e.push({key:"C",data:[c,u,f,p,h,a]}),i=t,r=s,n=h,o=a;break}case"A":{const t=Math.abs(l[0]),s=Math.abs(l[1]),h=l[2],a=l[3],i=l[4],r=l[5],c=l[6];if(0===t||0===s)e.push({key:"C",data:[n,o,r,c,r,c]}),n=r,o=c;else if(n!==r||o!==c){b(n,o,r,c,t,s,h,a,i).forEach((function(t){e.push({key:"C",data:t})})),n=r,o=c}break}case"Z":e.push({key:"Z",data:[]}),n=h,o=a}s=c}return e}function y(t,e,s){return[t*Math.cos(s)-e*Math.sin(s),t*Math.sin(s)+e*Math.cos(s)]}function b(t,e,s,n,o,h,a,i,r,c){const l=(u=a,Math.PI*u/180);var u;let f=[],p=0,g=0,d=0,M=0;if(c)[p,g,d,M]=c;else{[t,e]=y(t,e,-l),[s,n]=y(s,n,-l);const a=(t-s)/2,c=(e-n)/2;let u=a*a/(o*o)+c*c/(h*h);u>1&&(u=Math.sqrt(u),o*=u,h*=u);const f=o*o,k=h*h,m=f*k-f*c*c-k*a*a,b=f*c*c+k*a*a,_=(i===r?-1:1)*Math.sqrt(Math.abs(m/b));d=_*o*c/h+(t+s)/2,M=_*-h*a/o+(e+n)/2,p=Math.asin(parseFloat(((e-M)/h).toFixed(9))),g=Math.asin(parseFloat(((n-M)/h).toFixed(9))),t<d&&(p=Math.PI-p),s<d&&(g=Math.PI-g),p<0&&(p=2*Math.PI+p),g<0&&(g=2*Math.PI+g),r&&p>g&&(p-=2*Math.PI),!r&&g>p&&(g-=2*Math.PI)}let k=g-p;if(Math.abs(k)>120*Math.PI/180){const t=g,e=s,i=n;g=r&&g>p?p+120*Math.PI/180*1:p+120*Math.PI/180*-1,f=b(s=d+o*Math.cos(g),n=M+h*Math.sin(g),e,i,o,h,a,0,r,[g,t,d,M])}k=g-p;const m=Math.cos(p),_=Math.sin(p),w=Math.cos(g),x=Math.sin(g),v=Math.tan(k/4),S=4/3*o*v,P=4/3*h*v,O=[t,e],z=[t+S*_,e-P*m],L=[s+S*x,n-P*w],C=[s,n];if(z[0]=2*O[0]-z[0],z[1]=2*O[1]-z[1],c)return[z,L,C].concat(f);{f=[z,L,C].concat(f);const t=[];for(let e=0;e<f.length;e+=3){const s=y(f[e][0],f[e][1],l),n=y(f[e+1][0],f[e+1][1],l),o=y(f[e+2][0],f[e+2][1],l);t.push([s[0],s[1],n[0],n[1],o[0],o[1]])}return t}}const _={randOffset:function(t,e){return W(t,e)},randOffsetWithRange:function(t,e,s){return $(t,e,s)},ellipse:P,doubleLineOps:function(t,e,s,n,o){return A(t,e,s,n,o,!0)}};function w(t,e,s,n,o){return{type:"path",ops:A(t,e,s,n,o)}}function x(t,e,s){const n=(t||[]).length;if(n>2){const o=[];for(let e=0;e<n-1;e++)o.push(...A(t[e][0],t[e][1],t[e+1][0],t[e+1][1],s));return e&&o.push(...A(t[n-1][0],t[n-1][1],t[0][0],t[0][1],s)),{type:"path",ops:o}}return 2===n?w(t[0][0],t[0][1],t[1][0],t[1][1],s):{type:"path",ops:[]}}function v(t,e,s,n,o){return function(t,e){return x(t,!0,e)}([[t,e],[t+s,e],[t+s,e+n],[t,e+n]],o)}function S(t,e){if(t.length){const s="number"==typeof t[0][0]?[t]:t,n=j(s[0],1*(1+.2*e.roughness),e),o=e.disableMultiStroke?[]:j(s[0],1.5*(1+.22*e.roughness),T(e));for(let t=1;t<s.length;t++){const h=s[t];if(h.length){const t=j(h,1*(1+.2*e.roughness),e),s=e.disableMultiStroke?[]:j(h,1.5*(1+.22*e.roughness),T(e));for(const e of t)"move"!==e.op&&n.push(e);for(const t of s)"move"!==t.op&&o.push(t)}}return{type:"path",ops:n.concat(o)}}return{type:"path",ops:[]}}function P(t,e,s,n,o){return z(t,e,o,O(s,n,o)).opset}function O(t,e,s){const n=Math.sqrt(2*Math.PI*Math.sqrt((Math.pow(t/2,2)+Math.pow(e/2,2))/2)),o=Math.ceil(Math.max(s.curveStepCount,s.curveStepCount/Math.sqrt(200)*n)),h=2*Math.PI/o;let a=Math.abs(t/2),i=Math.abs(e/2);const r=1-s.curveFitting;return a+=W(a*r,s),i+=W(i*r,s),{increment:h,rx:a,ry:i}}function z(t,e,s,n){const[o,h]=q(n.increment,t,e,n.rx,n.ry,1,n.increment*$(.1,$(.4,1,s),s),s);let a=D(o,null,s);if(!s.disableMultiStroke&&0!==s.roughness){const[o]=q(n.increment,t,e,n.rx,n.ry,1.5,0,s),h=D(o,null,s);a=a.concat(h)}return{estimatedPoints:h,opset:{type:"path",ops:a}}}function L(t,e,s,n,o,h,a,i,r){const c=t,l=e;let u=Math.abs(s/2),f=Math.abs(n/2);u+=W(.01*u,r),f+=W(.01*f,r);let p=o,g=h;for(;p<0;)p+=2*Math.PI,g+=2*Math.PI;g-p>2*Math.PI&&(p=0,g=2*Math.PI);const d=2*Math.PI/r.curveStepCount,M=Math.min(d/2,(g-p)/2),k=F(M,c,l,u,f,p,g,1,r);if(!r.disableMultiStroke){const t=F(M,c,l,u,f,p,g,1.5,r);k.push(...t)}return a&&(i?k.push(...A(c,l,c+u*Math.cos(p),l+f*Math.sin(p),r),...A(c,l,c+u*Math.cos(g),l+f*Math.sin(g),r)):k.push({op:"lineTo",data:[c,l]},{op:"lineTo",data:[c+u*Math.cos(p),l+f*Math.sin(p)]})),{type:"path",ops:k}}function C(t,e){const s=m(k(M(t))),n=[];let o=[0,0],h=[0,0];for(const{key:t,data:a}of s)switch(t){case"M":h=[a[0],a[1]],o=[a[0],a[1]];break;case"L":n.push(...A(h[0],h[1],a[0],a[1],e)),h=[a[0],a[1]];break;case"C":{const[t,s,o,i,r,c]=a;n.push(...V(t,s,o,i,r,c,h,e)),h=[r,c];break}case"Z":n.push(...A(h[0],h[1],o[0],o[1],e)),h=[o[0],o[1]]}return{type:"path",ops:n}}function R(t,e){const s=[];for(const n of t)if(n.length){const t=e.maxRandomnessOffset||0,o=n.length;if(o>2){s.push({op:"move",data:[n[0][0]+W(t,e),n[0][1]+W(t,e)]});for(let h=1;h<o;h++)s.push({op:"lineTo",data:[n[h][0]+W(t,e),n[h][1]+W(t,e)]})}}return{type:"fillPath",ops:s}}function I(t,e){return function(t,e){let s=t.fillStyle||"hachure";if(!u[s])switch(s){case"zigzag":u[s]||(u[s]=new a(e));break;case"cross-hatch":u[s]||(u[s]=new i(e));break;case"dots":u[s]||(u[s]=new r(e));break;case"dashed":u[s]||(u[s]=new c(e));break;case"zigzag-line":u[s]||(u[s]=new l(e));break;case"hachure":default:s="hachure",u[s]||(u[s]=new o(e))}return u[s]}(e,_).fillPolygons(t,e)}function T(t){const e=Object.assign({},t);return e.randomizer=void 0,t.seed&&(e.seed=t.seed+1),e}function E(t){return t.randomizer||(t.randomizer=new p(t.seed||0)),t.randomizer.next()}function $(t,e,s,n=1){return s.roughness*n*(E(s)*(e-t)+t)}function W(t,e,s=1){return $(-t,t,e,s)}function A(t,e,s,n,o,h=!1){const a=h?o.disableMultiStrokeFill:o.disableMultiStroke,i=G(t,e,s,n,o,!0,!1);if(a)return i;const r=G(t,e,s,n,o,!0,!0);return i.concat(r)}function G(t,e,s,n,o,h,a){const i=Math.pow(t-s,2)+Math.pow(e-n,2),r=Math.sqrt(i);let c=1;c=r<200?1:r>500?.4:-.0016668*r+1.233334;let l=o.maxRandomnessOffset||0;l*l*100>i&&(l=r/10);const u=l/2,f=.2+.2*E(o);let p=o.bowing*o.maxRandomnessOffset*(n-e)/200,g=o.bowing*o.maxRandomnessOffset*(t-s)/200;p=W(p,o,c),g=W(g,o,c);const d=[],M=()=>W(u,o,c),k=()=>W(l,o,c),m=o.preserveVertices;return h&&(a?d.push({op:"move",data:[t+(m?0:M()),e+(m?0:M())]}):d.push({op:"move",data:[t+(m?0:W(l,o,c)),e+(m?0:W(l,o,c))]})),a?d.push({op:"bcurveTo",data:[p+t+(s-t)*f+M(),g+e+(n-e)*f+M(),p+t+2*(s-t)*f+M(),g+e+2*(n-e)*f+M(),s+(m?0:M()),n+(m?0:M())]}):d.push({op:"bcurveTo",data:[p+t+(s-t)*f+k(),g+e+(n-e)*f+k(),p+t+2*(s-t)*f+k(),g+e+2*(n-e)*f+k(),s+(m?0:k()),n+(m?0:k())]}),d}function j(t,e,s){if(!t.length)return[];const n=[];n.push([t[0][0]+W(e,s),t[0][1]+W(e,s)]),n.push([t[0][0]+W(e,s),t[0][1]+W(e,s)]);for(let o=1;o<t.length;o++)n.push([t[o][0]+W(e,s),t[o][1]+W(e,s)]),o===t.length-1&&n.push([t[o][0]+W(e,s),t[o][1]+W(e,s)]);return D(n,null,s)}function D(t,e,s){const n=t.length,o=[];if(n>3){const h=[],a=1-s.curveTightness;o.push({op:"move",data:[t[1][0],t[1][1]]});for(let e=1;e+2<n;e++){const s=t[e];h[0]=[s[0],s[1]],h[1]=[s[0]+(a*t[e+1][0]-a*t[e-1][0])/6,s[1]+(a*t[e+1][1]-a*t[e-1][1])/6],h[2]=[t[e+1][0]+(a*t[e][0]-a*t[e+2][0])/6,t[e+1][1]+(a*t[e][1]-a*t[e+2][1])/6],h[3]=[t[e+1][0],t[e+1][1]],o.push({op:"bcurveTo",data:[h[1][0],h[1][1],h[2][0],h[2][1],h[3][0],h[3][1]]})}if(e&&2===e.length){const t=s.maxRandomnessOffset;o.push({op:"lineTo",data:[e[0]+W(t,s),e[1]+W(t,s)]})}}else 3===n?(o.push({op:"move",data:[t[1][0],t[1][1]]}),o.push({op:"bcurveTo",data:[t[1][0],t[1][1],t[2][0],t[2][1],t[2][0],t[2][1]]})):2===n&&o.push(...G(t[0][0],t[0][1],t[1][0],t[1][1],s,!0,!0));return o}function q(t,e,s,n,o,h,a,i){const r=[],c=[];if(0===i.roughness){t/=4,c.push([e+n*Math.cos(-t),s+o*Math.sin(-t)]);for(let h=0;h<=2*Math.PI;h+=t){const t=[e+n*Math.cos(h),s+o*Math.sin(h)];r.push(t),c.push(t)}c.push([e+n*Math.cos(0),s+o*Math.sin(0)]),c.push([e+n*Math.cos(t),s+o*Math.sin(t)])}else{const l=W(.5,i)-Math.PI/2;c.push([W(h,i)+e+.9*n*Math.cos(l-t),W(h,i)+s+.9*o*Math.sin(l-t)]);const u=2*Math.PI+l-.01;for(let a=l;a<u;a+=t){const t=[W(h,i)+e+n*Math.cos(a),W(h,i)+s+o*Math.sin(a)];r.push(t),c.push(t)}c.push([W(h,i)+e+n*Math.cos(l+2*Math.PI+.5*a),W(h,i)+s+o*Math.sin(l+2*Math.PI+.5*a)]),c.push([W(h,i)+e+.98*n*Math.cos(l+a),W(h,i)+s+.98*o*Math.sin(l+a)]),c.push([W(h,i)+e+.9*n*Math.cos(l+.5*a),W(h,i)+s+.9*o*Math.sin(l+.5*a)])}return[c,r]}function F(t,e,s,n,o,h,a,i,r){const c=h+W(.1,r),l=[];l.push([W(i,r)+e+.9*n*Math.cos(c-t),W(i,r)+s+.9*o*Math.sin(c-t)]);for(let h=c;h<=a;h+=t)l.push([W(i,r)+e+n*Math.cos(h),W(i,r)+s+o*Math.sin(h)]);return l.push([e+n*Math.cos(a),s+o*Math.sin(a)]),l.push([e+n*Math.cos(a),s+o*Math.sin(a)]),D(l,null,r)}function V(t,e,s,n,o,h,a,i){const r=[],c=[i.maxRandomnessOffset||1,(i.maxRandomnessOffset||1)+.3];let l=[0,0];const u=i.disableMultiStroke?1:2,f=i.preserveVertices;for(let p=0;p<u;p++)0===p?r.push({op:"move",data:[a[0],a[1]]}):r.push({op:"move",data:[a[0]+(f?0:W(c[0],i)),a[1]+(f?0:W(c[0],i))]}),l=f?[o,h]:[o+W(c[p],i),h+W(c[p],i)],r.push({op:"bcurveTo",data:[t+W(c[p],i),e+W(c[p],i),s+W(c[p],i),n+W(c[p],i),l[0],l[1]]});return r}function Z(t){return[...t]}function B(t,e=0){const s=t.length;if(s<3)throw new Error("A curve must have at least three points.");const n=[];if(3===s)n.push(Z(t[0]),Z(t[1]),Z(t[2]),Z(t[2]));else{const s=[];s.push(t[0],t[0]);for(let e=1;e<t.length;e++)s.push(t[e]),e===t.length-1&&s.push(t[e]);const o=[],h=1-e;n.push(Z(s[0]));for(let t=1;t+2<s.length;t++){const e=s[t];o[0]=[e[0],e[1]],o[1]=[e[0]+(h*s[t+1][0]-h*s[t-1][0])/6,e[1]+(h*s[t+1][1]-h*s[t-1][1])/6],o[2]=[s[t+1][0]+(h*s[t][0]-h*s[t+2][0])/6,s[t+1][1]+(h*s[t][1]-h*s[t+2][1])/6],o[3]=[s[t+1][0],s[t+1][1]],n.push(o[1],o[2],o[3])}}return n}function Q(t,e){return Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2)}function H(t,e,s){const n=Q(e,s);if(0===n)return Q(t,e);let o=((t[0]-e[0])*(s[0]-e[0])+(t[1]-e[1])*(s[1]-e[1]))/n;return o=Math.max(0,Math.min(1,o)),Q(t,N(e,s,o))}function N(t,e,s){return[t[0]+(e[0]-t[0])*s,t[1]+(e[1]-t[1])*s]}function J(t,e,s,n){const o=n||[];if(function(t,e){const s=t[e+0],n=t[e+1],o=t[e+2],h=t[e+3];let a=3*n[0]-2*s[0]-h[0];a*=a;let i=3*n[1]-2*s[1]-h[1];i*=i;let r=3*o[0]-2*h[0]-s[0];r*=r;let c=3*o[1]-2*h[1]-s[1];return c*=c,a<r&&(a=r),i<c&&(i=c),a+i}(t,e)<s){const s=t[e+0];if(o.length){(h=o[o.length-1],a=s,Math.sqrt(Q(h,a)))>1&&o.push(s)}else o.push(s);o.push(t[e+3])}else{const n=.5,h=t[e+0],a=t[e+1],i=t[e+2],r=t[e+3],c=N(h,a,n),l=N(a,i,n),u=N(i,r,n),f=N(c,l,n),p=N(l,u,n),g=N(f,p,n);J([h,c,f,g],0,s,o),J([g,p,u,r],0,s,o)}var h,a;return o}function K(t,e){return U(t,0,t.length,e)}function U(t,e,s,n,o){const h=o||[],a=t[e],i=t[s-1];let r=0,c=1;for(let n=e+1;n<s-1;++n){const e=H(t[n],a,i);e>r&&(r=e,c=n)}return Math.sqrt(r)>n?(U(t,e,c+1,n,h),U(t,c,s,n,h)):(h.length||h.push(a),h.push(i)),h}function X(t,e=.15,s){const n=[],o=(t.length-1)/3;for(let s=0;s<o;s++){J(t,3*s,e,n)}return s&&s>0?U(n,0,n.length,s):n}const Y="none";class tt{constructor(t){this.defaultOptions={maxRandomnessOffset:2,roughness:1,bowing:1,stroke:"#000",strokeWidth:1,curveTightness:0,curveFitting:.95,curveStepCount:9,fillStyle:"hachure",fillWeight:-1,hachureAngle:-41,hachureGap:-1,dashOffset:-1,dashGap:-1,zigzagOffset:-1,seed:0,disableMultiStroke:!1,disableMultiStrokeFill:!1,preserveVertices:!1,fillShapeRoughnessGain:.8},this.config=t||{},this.config.options&&(this.defaultOptions=this._o(this.config.options))}static newSeed(){return f()}_o(t){return t?Object.assign({},this.defaultOptions,t):this.defaultOptions}_d(t,e,s){return{shape:t,sets:e||[],options:s||this.defaultOptions}}line(t,e,s,n,o){const h=this._o(o);return this._d("line",[w(t,e,s,n,h)],h)}rectangle(t,e,s,n,o){const h=this._o(o),a=[],i=v(t,e,s,n,h);if(h.fill){const o=[[t,e],[t+s,e],[t+s,e+n],[t,e+n]];"solid"===h.fillStyle?a.push(R([o],h)):a.push(I([o],h))}return h.stroke!==Y&&a.push(i),this._d("rectangle",a,h)}ellipse(t,e,s,n,o){const h=this._o(o),a=[],i=O(s,n,h),r=z(t,e,h,i);if(h.fill)if("solid"===h.fillStyle){const s=z(t,e,h,i).opset;s.type="fillPath",a.push(s)}else a.push(I([r.estimatedPoints],h));return h.stroke!==Y&&a.push(r.opset),this._d("ellipse",a,h)}circle(t,e,s,n){const o=this.ellipse(t,e,s,s,n);return o.shape="circle",o}linearPath(t,e){const s=this._o(e);return this._d("linearPath",[x(t,!1,s)],s)}arc(t,e,s,n,o,h,a=!1,i){const r=this._o(i),c=[],l=L(t,e,s,n,o,h,a,!0,r);if(a&&r.fill)if("solid"===r.fillStyle){const a=Object.assign({},r);a.disableMultiStroke=!0;const i=L(t,e,s,n,o,h,!0,!1,a);i.type="fillPath",c.push(i)}else c.push(function(t,e,s,n,o,h,a){const i=t,r=e;let c=Math.abs(s/2),l=Math.abs(n/2);c+=W(.01*c,a),l+=W(.01*l,a);let u=o,f=h;for(;u<0;)u+=2*Math.PI,f+=2*Math.PI;f-u>2*Math.PI&&(u=0,f=2*Math.PI);const p=(f-u)/a.curveStepCount,g=[];for(let t=u;t<=f;t+=p)g.push([i+c*Math.cos(t),r+l*Math.sin(t)]);return g.push([i+c*Math.cos(f),r+l*Math.sin(f)]),g.push([i,r]),I([g],a)}(t,e,s,n,o,h,r));return r.stroke!==Y&&c.push(l),this._d("arc",c,r)}curve(t,e){const s=this._o(e),n=[],o=S(t,s);if(s.fill&&s.fill!==Y)if("solid"===s.fillStyle){const e=S(t,Object.assign(Object.assign({},s),{disableMultiStroke:!0,roughness:s.roughness?s.roughness+s.fillShapeRoughnessGain:0}));n.push({type:"fillPath",ops:this._mergedShape(e.ops)})}else{const e=[],o=t;if(o.length){const t="number"==typeof o[0][0]?[o]:o;for(const n of t)n.length<3?e.push(...n):3===n.length?e.push(...X(B([n[0],n[0],n[1],n[2]]),10,(1+s.roughness)/2)):e.push(...X(B(n),10,(1+s.roughness)/2))}e.length&&n.push(I([e],s))}return s.stroke!==Y&&n.push(o),this._d("curve",n,s)}polygon(t,e){const s=this._o(e),n=[],o=x(t,!0,s);return s.fill&&("solid"===s.fillStyle?n.push(R([t],s)):n.push(I([t],s))),s.stroke!==Y&&n.push(o),this._d("polygon",n,s)}path(t,e){const s=this._o(e),n=[];if(!t)return this._d("path",n,s);t=(t||"").replace(/\n/g," ").replace(/(-\s)/g,"-").replace("/(ss)/g"," ");const o=s.fill&&"transparent"!==s.fill&&s.fill!==Y,h=s.stroke!==Y,a=!!(s.simplification&&s.simplification<1),i=function(t,e,s){const n=m(k(M(t))),o=[];let h=[],a=[0,0],i=[];const r=()=>{i.length>=4&&h.push(...X(i,e)),i=[]},c=()=>{r(),h.length&&(o.push(h),h=[])};for(const{key:t,data:e}of n)switch(t){case"M":c(),a=[e[0],e[1]],h.push(a);break;case"L":r(),h.push([e[0],e[1]]);break;case"C":if(!i.length){const t=h.length?h[h.length-1]:a;i.push([t[0],t[1]])}i.push([e[0],e[1]]),i.push([e[2],e[3]]),i.push([e[4],e[5]]);break;case"Z":r(),h.push([a[0],a[1]])}if(c(),!s)return o;const l=[];for(const t of o){const e=K(t,s);e.length&&l.push(e)}return l}(t,1,a?4-4*(s.simplification||1):(1+s.roughness)/2),r=C(t,s);if(o)if("solid"===s.fillStyle)if(1===i.length){const e=C(t,Object.assign(Object.assign({},s),{disableMultiStroke:!0,roughness:s.roughness?s.roughness+s.fillShapeRoughnessGain:0}));n.push({type:"fillPath",ops:this._mergedShape(e.ops)})}else n.push(R(i,s));else n.push(I(i,s));return h&&(a?i.forEach(t=>{n.push(x(t,!1,s))}):n.push(r)),this._d("path",n,s)}opsToPath(t,e){let s="";for(const n of t.ops){const t="number"==typeof e&&e>=0?n.data.map(t=>+t.toFixed(e)):n.data;switch(n.op){case"move":s+=`M${t[0]} ${t[1]} `;break;case"bcurveTo":s+=`C${t[0]} ${t[1]}, ${t[2]} ${t[3]}, ${t[4]} ${t[5]} `;break;case"lineTo":s+=`L${t[0]} ${t[1]} `}}return s.trim()}toPaths(t){const e=t.sets||[],s=t.options||this.defaultOptions,n=[];for(const t of e){let e=null;switch(t.type){case"path":e={d:this.opsToPath(t),stroke:s.stroke,strokeWidth:s.strokeWidth,fill:Y};break;case"fillPath":e={d:this.opsToPath(t),stroke:Y,strokeWidth:0,fill:s.fill||Y};break;case"fillSketch":e=this.fillSketch(t,s)}e&&n.push(e)}return n}fillSketch(t,e){let s=e.fillWeight;return s<0&&(s=e.strokeWidth/2),{d:this.opsToPath(t),stroke:e.fill||Y,strokeWidth:s,fill:Y}}_mergedShape(t){return t.filter((t,e)=>0===e||"move"!==t.op)}}let et=null;function st(t,e,s){return Object.assign(Object.assign(Object.assign({},function(){if(!et){const t=new tt;et=t.defaultOptions}return et}()),{maxRandomnessOffset:2,roughness:"highlight"===t?3:1.5,bowing:1,stroke:"#000",strokeWidth:1.5,curveTightness:0,curveFitting:.95,curveStepCount:9,fillStyle:"hachure",fillWeight:-1,hachureAngle:-41,hachureGap:-1,dashOffset:-1,dashGap:-1,zigzagOffset:-1,disableMultiStroke:"double"!==t,disableMultiStrokeFill:!1,preserveVertices:!0,seed:e}),s)}function nt(e,s,n,o,h,a){const i=[];let r=n.strokeWidth||2;const c=function(t){const e=t.padding;if(e||0===e){if("number"==typeof e)return[e,e,e,e];if(Array.isArray(e)){const t=e;if(t.length)switch(t.length){case 4:return[...t];case 1:return[t[0],t[0],t[0],t[0]];case 2:return[...t,...t];case 3:return[...t,t[1]];default:return[t[0],t[1],t[2],t[3]]}}}return[5,5,5,5]}(n),l=void 0===n.animate||!!n.animate,u=n.iterations||2,f=n.rtl?1:0,p=st("single",a,n);switch(n.type){case"underline":{const t=s.y+s.h+c[2];for(let e=f;e<u+f;e++)e%2?i.push(w(s.x+s.w,t,s.x,t,p)):i.push(w(s.x,t,s.x+s.w,t,p));break}case"strike-through":{const t=s.y+s.h/2;for(let e=f;e<u+f;e++)e%2?i.push(w(s.x+s.w,t,s.x,t,p)):i.push(w(s.x,t,s.x+s.w,t,p));break}case"box":{const t=s.x-c[3],e=s.y-c[0],n=s.w+(c[1]+c[3]),o=s.h+(c[0]+c[2]);for(let s=0;s<u;s++)i.push(v(t,e,n,o,p));break}case"bracket":{const t=Array.isArray(n.brackets)?n.brackets:n.brackets?[n.brackets]:["right"],e=s.x-2*c[3],o=s.x+s.w+2*c[1],h=s.y-2*c[0],a=s.y+s.h+2*c[2];for(const n of t){let t;switch(n){case"bottom":t=[[e,s.y+s.h],[e,a],[o,a],[o,s.y+s.h]];break;case"top":t=[[e,s.y],[e,h],[o,h],[o,s.y]];break;case"left":t=[[s.x,h],[e,h],[e,a],[s.x,a]];break;case"right":t=[[s.x+s.w,h],[o,h],[o,a],[s.x+s.w,a]]}t&&i.push(x(t,!1,p))}break}case"crossed-off":{const t=s.x,e=s.y,n=t+s.w,o=e+s.h;for(let s=f;s<u+f;s++)s%2?i.push(w(n,o,t,e,p)):i.push(w(t,e,n,o,p));for(let s=f;s<u+f;s++)s%2?i.push(w(t,o,n,e,p)):i.push(w(n,e,t,o,p));break}case"circle":{const t=st("double",a,n),e=s.w+(c[1]+c[3]),o=s.h+(c[0]+c[2]),h=s.x-c[3]+e/2,r=s.y-c[0]+o/2,l=Math.floor(u/2),f=u-2*l;for(let s=0;s<l;s++)i.push(P(h,r,e,o,t));for(let t=0;t<f;t++)i.push(P(h,r,e,o,p));break}case"highlight":{const t=st("highlight",a,n);r=.95*s.h;const e=s.y+s.h/2;for(let n=f;n<u+f;n++)n%2?i.push(w(s.x+s.w,e,s.x,e,t)):i.push(w(s.x,e,s.x+s.w,e,t));break}}if(i.length){const s=function(t){const e=[];for(const s of t){let t="";for(const n of s.ops){const s=n.data;switch(n.op){case"move":t.trim()&&e.push(t.trim()),t=`M${s[0]} ${s[1]} `;break;case"bcurveTo":t+=`C${s[0]} ${s[1]}, ${s[2]} ${s[3]}, ${s[4]} ${s[5]} `;break;case"lineTo":t+=`L${s[0]} ${s[1]} `}}t.trim()&&e.push(t.trim())}return e}(i),a=[],c=[];let u=0;const f=(t,e,s)=>t.setAttribute(e,s);for(const o of s){const s=document.createElementNS(t,"path");if(f(s,"d",o),f(s,"fill","none"),f(s,"stroke",n.color||"currentColor"),f(s,"stroke-width",""+r),void 0!==n.opacity&&f(s,"style","opacity:"+n.opacity),l){const t=s.getTotalLength();a.push(t),u+=t}e.appendChild(s),c.push(s)}if(n.zIndex&&e.setAttribute("z-index",""+n.zIndex),l){let t=0;for(let e=0;e<c.length;e++){const s=c[e],n=a[e],i=u?h*(n/u):0,r=o+t,l=s.style;l.strokeDashoffset=""+n,l.strokeDasharray=""+n,l.animation=`rough-notation-dash ${i}ms ease-out ${r}ms forwards`,t+=i}return ot(h+o)}}return ot(0)}function ot(t){return new Promise(e=>setTimeout(e,t))}class ht{constructor(t,e){this._state="unattached",this._resizing=!1,this._seed=f(),this._lastSizes=[],this._animationDelay=0,this._resizeListener=()=>{this._resizing||(this._resizing=!0,setTimeout(()=>{this._resizing=!1,"showing"===this._state&&this.haveRectsChanged()&&this.show()},400))},this._e=t,this._config=JSON.parse(JSON.stringify(e)),this.attach()}getConfig(t){return this._config[t]}setConfig(t,e){this._config[t]!==e&&(this._config[t]=e,this.refresh())}get animate(){return this._config.animate}set animate(t){this._config.animate=t}get animationDuration(){return this._config.animationDuration}set animationDuration(t){this._config.animationDuration=t}get iterations(){return this._config.iterations}set iterations(t){this._config.iterations=t}get color(){return this._config.color}set color(t){this._config.color!==t&&(this._config.color=t,this.refresh())}get class(){return this._config.class}set class(t){this._config.class!==t&&(this._config.class=t,this._svg&&this._svg.setAttribute("class",["rough-annotation",this._config.class||""].filter(Boolean).join(" ")))}get strokeWidth(){return this._config.strokeWidth}set strokeWidth(t){this._config.strokeWidth!==t&&(this._config.strokeWidth=t,this.refresh())}get padding(){return this._config.padding}set padding(t){this._config.padding!==t&&(this._config.padding=t,this.refresh())}get type(){return this._config.type}attach(){if("unattached"===this._state&&this._e.parentElement){!function(){if(!window.__rno_kf_s){const t=window.__rno_kf_s=document.createElement("style");t.textContent="@keyframes rough-notation-dash { to { stroke-dashoffset: 0; } }",document.head.appendChild(t)}}();const e=this._svg=document.createElementNS(t,"svg");e.setAttribute("class",["rough-annotation",this._config.class||""].filter(Boolean).join(" "));const s=e.style;s.position="absolute",s.top="0",s.left="0",s.overflow="visible",s.pointerEvents="none",s.width="100px",s.height="100px";const n="highlight"===this._config.type;if(this._e.insertAdjacentElement(n?"beforebegin":"afterend",e),this._state="not-showing",n){const t=window.getComputedStyle(this._e).position;(!t||"static"===t)&&(this._e.style.position="relative")}this.attachListeners()}}detachListeners(){window.removeEventListener("resize",this._resizeListener),this._ro&&this._ro.unobserve(this._e)}attachListeners(){this.detachListeners(),window.addEventListener("resize",this._resizeListener,{passive:!0}),!this._ro&&"ResizeObserver"in window&&(this._ro=new window.ResizeObserver(t=>{for(const e of t)e.contentRect&&this._resizeListener()})),this._ro&&this._ro.observe(this._e)}haveRectsChanged(){if(this._lastSizes.length){const t=this.rects();if(t.length!==this._lastSizes.length)return!0;for(let e=0;e<t.length;e++)if(!this.isSameRect(t[e],this._lastSizes[e]))return!0}return!1}isSameRect(t,e){const s=(t,e)=>Math.round(t)===Math.round(e);return s(t.x,e.x)&&s(t.y,e.y)&&s(t.w,e.w)&&s(t.h,e.h)}isShowing(){return"not-showing"!==this._state}refresh(){this.isShowing()&&!this.pendingRefresh&&(this.pendingRefresh=Promise.resolve().then(()=>{this.isShowing()&&this.show(),delete this.pendingRefresh}))}async show(){switch(this._state){case"unattached":break;case"showing":this.hide(),this._svg&&await this.render(this._svg,!0);break;case"not-showing":this.attach(),this._svg&&await this.render(this._svg,!1)}}hide(){if(this._svg)for(;this._svg.lastChild;)this._svg.removeChild(this._svg.lastChild);this._state="not-showing"}remove(){this._svg&&this._svg.parentElement&&this._svg.parentElement.removeChild(this._svg),this._svg=void 0,this._state="unattached",this.detachListeners()}async render(t,e){let s=this._config;e&&(s=JSON.parse(JSON.stringify(this._config)),s.animate=!1);const n=this.rects();let o=0;n.forEach(t=>o+=t.w);const h=s.animationDuration||800;let a=0;const i=[];for(let e=0;e<n.length;e++){const r=h*(n[e].w/o);i.push(nt(t,n[e],s,a+this._animationDelay+(this._config.delay||0),r,this._seed)),a+=r}return this._lastSizes=n,this._state="showing",await Promise.all(i)}rects(){const t=[];if(this._svg)if(this._config.multiline){const e=this._e.getClientRects();for(let s=0;s<e.length;s++)t.push(this.svgRect(this._svg,e[s]))}else t.push(this.svgRect(this._svg,this._e.getBoundingClientRect()));return t}svgRect(t,e){const s=t.getBoundingClientRect(),n=e;return{x:(n.x||n.left)-(s.x||s.left),y:(n.y||n.top)-(s.y||s.top),w:n.width,h:n.height}}}exports.annotate=function(t,e){return new ht(t,e)},exports.annotationGroup=function(t){let e=0;for(const s of t){const t=s;t._animationDelay=e;e+=0===t.animationDuration?0:t.animationDuration||800}const s=[...t];return{show(){for(const t of s)t.show()},hide(){for(const t of s)t.hide()}}};
